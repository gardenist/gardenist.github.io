---
title: 해시 함수와 bcryptjs
date: 2019-11-24 17:40:29
tags:
categories: javascript
---
# 해시 함수(Hash Function)
> 임의의 길이의 데이터를 고정된 길이의 데이터로 매핑하는 함수이다. 해시 함수에 의해 얻어지는 값은 해시 값, 해시 코드, 해시 체크섬 또는 간단하게 해시라고 한다. - [위키피디아 해시 함수 문서](https://ko.wikipedia.org/wiki/해시_함수)

임의의 길이의 데이터를 고정된 길이의 데이터로 매핑한다는 것은, 입력된 데이터의 길이가 1이든 10이든 100이든 해시 함수에서 정한 고정된 길이로 해시의 결과를 얻을 수 있다는 의미입니다.
해시 함수는 `입력값` -> `해시` 로의 변환은 가능하지만 `해시` -> `입력값`으로의 복구는 어려운 특징이 있으며, 이러한 특징으로 원본을 숨기기 위해서 서비스의 사용자 비밀번호를 해시하여 저장하기도 하고, 블록체인에도 활용되며, 파일의 위/변조를 확인하기 위해서, 해시 테이블이라는 자료구조에서 활용되는 등 사실상 "해시"의 개념이 필요한 곳이라면 어디든 쓰일 수 있습니다.

<파일 다운로드 시 변조 여부 예시>

## 간단한 해시 함수 예시
잘 만들어진 해시 함수들이 많지만, 간단히 해수 함수를 이해하기 위한 예시를 들어보겠습니다. 
만들어보면 해시 함수는 `sum-hash`라고 이름 붙여보고, 아래와 같은 특징을 갖도록 구현해 봅시다.
1. 입력과 출력은 문자열 타입
2. 입력 받은 문자열의 각 글자의 코드 값을 합한 값을 해시로 사용합니다.
3. `sum-hash`의 해시된 결과 길이는 4자입니다.
4. 2의 과정에서 합한 값의 자리수가 4보다 적은 경우 출력 문자열의 앞에 모자란만큼 0을 채웁니다.
5. 2의 과정에서 합한 값의 자리수가 4보다 큰 경우 출력 문자열의 끝에서 4자리를 넘는 문자를 제거합니다.

이를 자바스크립트로 만들어보면 아래 정도로 만들어 볼 수 있습니다
```javascript
function sumHash(input) {

}
```

특징을 잘 구현했다면, 입력의 길이에 상관없이 항상 4자의 해시 값을 얻을 수 있습니다. 
```

```

`sum-hash`는 해시로 변환은 가능하지만 해시에서 원래의 입력값을 찾는 것은 어렵습니다.
```
'abcd'
'dcba'
'bbcc'
```
이렇게 서로 다른 입력에 대해 같은 해시가 출력되는 것을 해시 충돌(Hash Collision)이라고 합니다. 해시 함수의 특성상 결과는 고정된 길이를 가지므로 발생하는 현상입니다.
아파트와 입주민을 예로 들어본다면, 아파트(고정된 자리수)가 10채 있고, 사람(입력의 자리수)이 10명 이하일 때 빈 집에만 들어간다면 2명이 함께 있는 아파트는 없을 것이지만, 만약 10명을 초과하면 어느 아파트에는 적어도 2명 이상의 사람이 있을 수 밖에 없고, 이를 해시 충돌로 볼 수 있습니다.
참고로 아파트 대신 비둘기 집, 사람 대신 비둘기로 표현한 원리를 **비둘기집 원리**라고 합니다.

## 암호화와 해시
암호화와 해시는 입력이 변환된 결과를 출력하는 것은 동일하지만, 해시는 입력->출력으로만 가능하고 출력->입력으로는 불가능하며, 암호화에서는 입력->출력, 출력->입력 양방향 모두 가능합니다. 암호화에서 출력->입력을 `복호화(Decryption)`이라고 합니다.
정리하면 해시는 단방향, 암호화는 양방향의 특징을 갖습니다.

# bcrypt와 bcryptjs

## SALT
이러한 해시 함수는 

자바스크립트에서는 bcrypt를 사용하기 위해서 `bcryptjs`를 사용하며, 스터디 때는 npm으로 `bcyprtjs` 모듈을 다운로드 하여 사용해봤습니다. 이 글에서는 스터디 때 했던 것과 동일하게 사용해 보도록 하겠습니다.

## npm을 이용한 bcryptjs 다운로드

## `bcryptjs`로 해시하기

## `bcryptjs`로 비밀번호 검증하기

## References
- https://en.wikipedia.org/wiki/Bcrypt
- https://ko.wikipedia.org/wiki/해시_함수
- https://ko.wikipedia.org/wiki/해시_충돌
- https://d2.naver.com/helloworld/318732
